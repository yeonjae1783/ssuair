<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">

<head>
    <title>{{ title }} {{message}}</title>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <!--<meta name="description" content="Bootstrap 4 Mobile App Template">-->
    <!--<meta name="author" content="Xiaoying Riley at 3rd Wave Media">-->
    <!--<link rel="shortcut icon" href="favicon.ico">-->
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css?family=Maven+Pro:400,500,700|Nunito:400,600,700" rel="stylesheet">
    <!-- FontAwesome JS-->
    <script src="https://kit.fontawesome.com/849dcab7e5.js"></script>
    <!-- Theme CSS -->
    <link href="/static/css/theme.css" id="theme-style" rel="stylesheet">
</head>

<body>
<header class="header">
    <div class="branding">
        <div class="container position-relative">
            <nav class="navbar navbar-expand-lg">
                <h1 class="site-logo"><a class="navbar-brand" href="/">
                    <span class="logo-text"><i class="fas fa-fan"></i> SSUAIR</span></a></h1>
            </nav>
            <!-- // Free Version ONLY -->
            <ul class="social-list list-inline mb-0 position-absolute">
                <!--<li class="list-inline-item"><a class="text-dark" href="https://github.com/yeonjae1783/ssuair.git"><i-->
                <!--class="fab fa-github fa-fw"></i></a></li>-->
                <li class="list-inline-item"><span>{{ formatted_now }}  <a class="text-dark" href="/"><i
                        class="fa fa-refresh"></i></a></span></li>
            </ul>
            <!--//social-list-->
        </div>
        <!--//container-->
    </div>
    <!--//branding-->
</header>
<!--//header-->
<section class="hero-section">
    <div class="container py-lg-5">
        <div class="row">
            <div class="col-12  col-md-10 pt-md-4">
                <h1 id="resultSum" style="color:#47b0df;"></h1>
                <h2  id="result" class="site-headline font-weight-bold pt-lg-5"></h2>
                <div id="resultSub" class="site-tagline mb-3">현재는 실시간 관측된 자료이며 측정소 현지 사정이나 한국환경공단 에어코리아 공공 데이터의 수신상태에 따라 데이터가 기록되지 않을 수
                    있습니다. 오늘 오전과 오후, 내일과 모레, 주간 예보는 케이웨더가 대기환경 예보모델(CMAQ)을 적용해 해당 시간대의 평균적인 상황을 예측한 예보치 므로 실제 측정치와 차이가
                    발생할 수 있습니다. ‘한때나쁨’은 나쁨(81-150㎍/m)상태가 6시간 미만인 상태를 의미합니다. 모레 데이터는 오전 5시 이후 업데이트 됩니다.
                    최종업데이트 현재 2019.08.17. 19:00, 예보 2019.08.17. 17:00

                </div>
            </div>
        </div>
        <!--//row-->
    </div>
</section>
<!--//hero-section-->
<section class="features-section py-5">
    <div class="container py-lg-5">
        <h3 class="mb-3 text-center font-weight-bold section-heading"></h3>
        <div class="row pt-5 mb-5">
            <div class="col-12 col-lg-4">

                <div class="slide">
                <div class="card rounded border-0 shadow-lg mb-5">
                    <div class="card-body p-4">
                        <h5 class="card-title mb-5"><i
                                class="far fa-chart-bar mr-2 mr-lg-3 text-primary fa-lg fa-fw"></i>불쾌지수</h5>
                        <!-- Progress bar 1 -->
                        <div class="progress mx-auto" data-value='80'>
                                <span class="progress-left">
                                    <span class="progress-bar border-primary"></span>
                                </span>
                            <span class="progress-right">
                                    <span class="progress-bar border-primary"></span>
                                </span>
                            <div class="progress-value w-100 h-100 rounded-circle d-flex align-items-center justify-content-center">
                                <h2 class="font-weight-bold">{{ discomfort }}<sup class="small">DI</sup></h2>
                            </div>
                        </div>
                        <a href="https://thingspeak.com/channels/768165">Learn more <span
                                class="more-arrow">&rarr;</span></a>
                    </div>
                </div>
                </div>
                <div class="slide">
                    <div class="card rounded border-0 shadow-lg mb-5">
                            <div class="card-body p-4">
                                    <h5 class="card-title mb-5"><i
                                            class="far fa-chart-bar mr-2 mr-lg-3 text-primary fa-lg fa-fw"></i>불쾌지수</h5>
                                    <!-- chart 1 -->
                                    <div class="chart1">
                                        <p> 이부분을 차트로 수정</p>
                                    </div>
                                    <a href="https://thingspeak.com/channels/768165">Learn more <span
                                            class="more-arrow">&rarr;</span></a>
                            </div>
                    </div>
                </div>
                <!--//card-->
            </div>


            <div class="col-12 col-lg-4">
                <div class="slide2">
                <div class="card rounded border-0 shadow-lg mb-5">
                    <div class="card-body p-4">
                        <h5 class="card-title mb-5"><i
                                class="fas fa-laptop-code mr-2 mr-lg-3 text-primary fa-lg fa-fw"></i>실내 미세먼지</h5>
                        <!-- Progress bar 2 -->
                        <div class="progress mx-auto" data-value='25'>
                                <span class="progress-left">
                                    <span class="progress-bar border-danger"></span>
                                </span>
                            <span class="progress-right">
                                    <span class="progress-bar border-danger"></span>
                                </span>
                            <div class="progress-value w-100 h-100 rounded-circle d-flex align-items-center justify-content-center">
                                <h2 class="font-weight-bold">{{ last_indoor }}<sup class="small">PM</sup></h2>
                            </div>
                        </div>
                        <a href="https://thingspeak.com/channels/768165">Learn more <span
                                class="more-arrow">&rarr;</span></a>
                    </div>
                    </div>
                </div>
                <div class="slide2">
                        <div class="card rounded border-0 shadow-lg mb-5">
                                <div class="card-body p-4">
                                        <h5 class="card-title mb-5"><i
                                                class="fas fa-laptop-code mr-2 mr-lg-3 text-primary fa-lg fa-fw"></i>실내 미세먼지</h5>
                                        <!-- chart2 -->
                                        <div class="chart2">
                                            <canvas id="SlideChart2"></canvas>
                                        </div>
                                        <a href="https://thingspeak.com/channels/768165">Learn more <span
                                                class="more-arrow">&rarr;</span></a>
                                </div>
                        </div>
                </div>
                <!--//card-->
            </div>
            <div class="col-12 col-lg-4">
                <div class="slide3">
                <div class="card rounded-lg border-0 shadow-lg">
                    <div class="card-body p-4">
                        <h5 class="card-title mb-5"><i
                                class="far fa-calendar-alt mr-2 mr-lg-3 text-primary fa-lg fa-fw"></i>실외 미세먼지</h5>
                        <!-- Progress bar 3 -->
                        <div class="progress mx-auto" data-value='76'>
                                <span class="progress-left">
                                    <span class="progress-bar border-success"></span>
                                </span>
                            <span class="progress-right">
                                    <span class="progress-bar border-success"></span>
                                </span>
                            <div class="progress-value w-100 h-100 rounded-circle d-flex align-items-center justify-content-center">

                                <h2 class="font-weight-bold">{{ outdoorAir }}<sup class="small">PM</sup></h2>

                            </div>
                        </div>
                        <!-- END -->
                        <!-- Demo info -->
                        <!--<div class="row text-center mt-4 mb-3">-->
                        <!--<div class="col-6 border-right">-->
                        <!--<h5 class="mb-0">28%</h5>-->
                        <!--<span class="small text-gray">Last week</span>-->
                        <!--</div>-->
                        <!--<div class="col-6">-->
                        <!--<h5 class="mb-0">60%</h5>-->
                        <!--<span class="small text-gray">Last month</span>-->
                        <!--</div>-->
                        <!--</div>-->
                        <!-- END -->
                        <a href="https://thingspeak.com/channels/768165">Learn more <span
                                class="more-arrow">&rarr;</span></a>
                    </div>
                    </div>
                </div>
                <div class="slide3">
                        <div class="card rounded border-0 shadow-lg mb-5">
                                <div class="card-body p-4">
                                        <h5 class="card-title mb-5"><i
                                            class="far fa-calendar-alt mr-2 mr-lg-3 text-primary fa-lg fa-fw"></i>실외 미세먼지</h5>
                                        <!--chart 3 -->
                                        <div class="chart3">
                                            <p> 이부분을 차트로 수정</p>
                                        </div>
                                        <a href="https://thingspeak.com/channels/768165">Learn more <span
                                                class="more-arrow">&rarr;</span></a>
                                </div>
                        </div>
                </div>
                <!--//card-->
            </div>
        </div>
    </div>
    <!--//container-->
</section>
<!--//features-section-->
<section class="cta-section py-5 theme-bg-secondary text-center">
    <div class="container">
        <h3 class="text-white font-weight-bold mb-3">미세먼지 예측</h3>
        <div class="text-white mx-auto single-col-max-width section-intro">
            <canvas id="myChart"></canvas>
            <!--Try Nova Free Today. Lorem ipsum dolor sit-->
            <!--amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque-->
            <!--penatibus et magnis dis.-->
        </div>
        <p style="font-size: 1.3em; color: white;"> 
        기기를 통해 측정한 최근 24시간 동안의 실내 미세먼지와 그 예측값을 나타낸 그래프입니다. <br>
        측정한 데이터를 기반으로 LSTM모델, ARIMA모델을 이용하여 한 시간 뒤의 값을 예측하였습니다. <br>
        LSTM모델과 ARIMA모델의 RMSE(평균 제곱근 오차)는 각각 8.3과 18.3입니다.
    </p>
    </div>
</section>
<!--//cta-section-->

<!--<footer class="footer theme-bg-primary">-->
<!--<div class="container py-5 mb-3">-->
<!--<div class="row">-->
<!--<div class="footer-col col-6 col-lg-3">-->
<!--<h4 class="col-heading">About Nova</h4>-->
<!--<ul class="list-unstyled">-->
<!--<li><a href="#">Our Story</a></li>-->
<!--<li><a href="#">Pricing</a></li>-->
<!--<li><a href="#">Contact</a></li>-->
<!--<li><a href="#">Jobs</a></li>-->
<!--</ul>-->
<!--</div>-->
<!--&lt;!&ndash;//footer-col&ndash;&gt;-->
<!--</div>-->
<!--&lt;!&ndash;//row&ndash;&gt;-->
<!--</div>-->
<!--&lt;!&ndash;//container&ndash;&gt;-->
<!--<div class="container">-->
<!--<hr>-->
<!--</div>-->
<!--<div class="download-area py-4">-->
<!--<div class="container text-center">-->
<!--<h3 class="mb-3">Get the app</h3>-->
<!--<div class="section-intro mb-4 single-col-max-width mx-auto">Download our apps now. lorem ipsum dolor sit-->
<!--amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque-->
<!--penatibus et magnis dis.-->
<!--</div>-->
<!--</div>-->
<!--&lt;!&ndash;//container&ndash;&gt;-->
<!--</div>-->
<!--&lt;!&ndash;//download-area&ndash;&gt;-->
<!--</footer>-->
<!--//footer-->

<!-- Javascript -->
<script src="/static/js/jquery-3.3.1.min.js" type="text/javascript"></script>
<script src="/static/js/popper.min.js" type="text/javascript"></script>
<script src="/static/js/bootstrap.min.js" type="text/javascript"></script>
<script src="/static/js/moment.js" type="text/javascript"></script>
<script src="/static/js/Chart.min.js" type="text/javascript"></script>
<script src="/static/js/utils.js" type="text/javascript"></script>
<script>

//가운데부분
var slide1 = document.getElementsByClassName("slide");
var slide2 = document.getElementsByClassName("slide2");
var slide3 = document.getElementsByClassName("slide3");
showSlides(slide1, 0);
showSlides(slide2, 0);
showSlides(slide3, 0);

function showSlides(slides, i) {
    if(i) // i가 1일 때
    {
        slides[1].style.display = "none";  
        slides[0].style.display = "block";
        i = 0; 
    }
    else 
    {
        slides[0].style.display = "none";  
        slides[1].style.display = "block";  
        i = 1;
    }
    setTimeout(showSlides, 5000, slides, i); // Change image every 5 seconds
}

</script>

<!-- 맨 밑 부분 그래프-->
<script>
function newDate() {
  return moment().add(days, 'd');
}

var arima_array = {{ predict_sarima }};
var lstm_array = {{ predict_lstm }};
var dust_array = {{ dust_array }};
var time_array = {{ time_array | safe }};

var config = {
  type: 'line',
  data: {
    labels : time_array,
    datasets: [{
      label: "sarima predict dataset",
      data: arima_array,
      borderColor: 'rgba(237, 110, 113, 1)',
      backgroundColor: 'rgba(237, 110, 113, 0.2)',
    },{
      label: "lstm predict dataset",
      data: lstm_array,
       borderColor: 'rgba(85, 161, 219, 1)',
       backgroundColor: 'rgba(85, 161, 219, 0.2)',
    },{
      label: "Last 24 hours pm10",
      data: dust_array,
       borderColor: 'rgba(108, 190, 191, 1)',
       backgroundColor: 'rgba(108, 190, 191, 0.2)',
    }]
  },
  options: {
    scales: {
      <!--xAxes:[{-->
  <!--type: 'time',-->
  <!--time: {-->
    <!--format: "HH:mm",-->
    <!--unit: 'hour',-->
    <!--unitStepSize: 1,-->
    <!--displayFormats: {-->
      <!--'minute': 'HH:mm',-->
      <!--'hour': 'HH:mm',-->
      <!--min: '00:00',-->
      <!--max: '23:59'-->
    <!--},-->
<!--}}],-->
    },
  }
};

var ctx = document.getElementById("myChart").getContext("2d");
new Chart(ctx, config);

//슬라이드에 차트들
var slide2_array = dust_array.slice(-6); // 6시간것만 보여주기
var slide_time = time_array.slice(-7, -1);
var config = {
  type: 'line',
  data: {
    labels : slide_time,
    datasets: [{
      data: slide2_array,
      borderColor: 'rgba(237, 110, 113, 1)',
      backgroundColor: 'rgba(237, 110, 113, 0.2)',
    }]
  },
  options:{
    scaleShowLabels : false,
    maintainAspectRatio: false,
    legend: {
            display: false,
        }
  }
};
var ctx = document.getElementById("SlideChart2").getContext("2d");
new Chart(ctx, config);


//맨 위 환기방안추천
var inAir={{ last_indoor }};
var outAir={{ outdoorAir }};
var predict = lstm_array[lstm_array.length-1];
var temp={{ temperature }};
var humidity={{ humidity }};
var discomfortIndex=temp*9/5-0.55*(1-humidity/100)*(9/5*temp-26)+32;
var result="";

if (inAir <= 75) { //실내 미세먼지 좋음
        if (outAir <= 80) { //실외 미세먼지 좋음
            if (predict <= 75) { //실내 미세먼지 예측값 좋음
                if (discomfortIndex <= 75) { //불쾌지수 좋음
                    result = "약 한 시간 정도 창문을 열면 건강한 숨을 쉴 수 있습니다."; //창문열어라
                    resultSub="실내공기와 실외공기가 좋습니다. 환기로 공기를 순환시키세요.";
                    resultSum="창문을 여세요";
                } else {
                    result = "에어컨을 키면 쾌적한 숨을 쉴 수 있습니다. ";
                    resultSub="실내공기와 실외공기가 좋지만 불쾌지수가f 나쁩니다. 에어컨을 통해 불쾌지수를 개선하세요.";
                    resultSum="에어컨을 키세요.";

                    //에어컨 켜라
                }
            } else { //예측값 나쁨
                result = "약 한 시간 정도 창문을 열면 건강한 숨을 쉴 수 있습니다."; //창문 열어라
                resultSub="실내공기와 실외공기가 좋습니다. 창문을 열지 않았을 때 한 시간 후 실내공기질이 나빠질 예정이니 창문을 여세요.";
                resultSum="창문을 여세요";

            }
        } else { //실외 미세먼지 나쁨
            if (discomfortIndex <= 75) { //불쾌지수 좋음
                result = "쾌적한 실내공기입니다. 실내공기와 불쾌지수가 좋습니다. "; //쾌적합니다!
                resultSub="실외 미세먼지가 좋지 않으니 창문을 열지 마시고 현재 공기질을 유지하세요.";
                resultSum="현재 쾌적한 공기질입니다.";

            } else {
                result = "에어컨을 키면 쾌적한 숨을 쉴 수 있습니다. ";
                resultSub="실내공기는 좋지만 불쾌지수와 실외공기가 나쁩니다.";
                resultSum="에어컨을 키세요.";

                //에어컨 켜라 여기 다시 보기~~~~
            }
        }
    } else { //실내 미세먼지 나쁨
        if (outAir <= 80) { //실외 미세먼지 좋음

            if (discomfortIndex <= 75) { //불쾌지수 좋음
                result = "약 한 시간 정도 창문을 열면 건강한 숨을 쉴 수 있습니다."; //창문열어라

                resultSub="실내공기가 나쁜 반면 실외공기가 좋습니다.";
                resultSum="창문을 여세요";

            } else {
                result = "에어컨을 키면 쾌적한 숨을 쉴 수 있습니다. ";
                resultSub="에어컨을 통해 불쾌지수를 개선하세요.";
                resultSum="에어컨을 키세요.";

                //에어컨 켜라
            }

        } else { //실외 미세먼지 나쁨
            result = "공기청정기를 통해 실내공기를 개선하세요. "; //공기청정기
            resultSub="실내공기와 실외공기 모두 좋지 않습니다.";
            resultSum="공기청정기를 키세요.";

        }
    }

var resultText = document.getElementById("result");
resultText.innerHTML=result;

var resultSubText = document.getElementById("resultSub");
resultSubText.innerHTML=resultSub;

var resultSumText = document.getElementById("resultSum");
resultSumText.innerHTML="<br><br>"+resultSum;


</script>


<!--Circular Progress Bar-->
<!--https://bootstrapious.com/p/circular-progress-bar-->
<script>
    $(function() {

        $(".progress").each(function() {

            var value = $(this).attr('data-value');
            var left = $(this).find('.progress-left .progress-bar');
            var right = $(this).find('.progress-right .progress-bar');

            if (value > 0) {
                if (value <= 50) {
                    right.css('transform', 'rotate(' + percentageToDegrees(value) + 'deg)')
                } else {
                    right.css('transform', 'rotate(180deg)')
                    left.css('transform', 'rotate(' + percentageToDegrees(value - 50) + 'deg)')
                }
            }

        })

        function percentageToDegrees(percentage) {

            return percentage / 100 * 360

        }

    });

</script>
</body>

</html>
